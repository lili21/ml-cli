#!/usr/bin/env node

var program = require('commander');
var chalk = require('chalk');
var path = require('path');
var exists = require('fs').existsSync;
var logger = require('../lib/logger');
var generate = require('../lib/generate');

program
  .usage('<project-name>')
  .on('--help', function() {
    console.log('  Examples:')
    console.log()
    console.log(chalk.gray('    # create a new project'))
    console.log('    $ ml init my-project')
    console.log()
  })
  .parse(process.argv);

if (program.args.length < 1) {
  return program.help();
}

console.log();
process.on('exit', function() {
  console.log();
});

var name = program.args[0];
var template = path.join(__dirname, '../templates/default');

var dest = path.resolve(name);

if (exists(dest)) {
  logger.fatal('"%s" already exists', name);
}

if (exists(template)) {
  generate(name, template, dest, function(err) {
    if (err) {
      logger.fatal(err);
    }
    console.log();
    logger.success('Generated "%s".', name);
  });
}
